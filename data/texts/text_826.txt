Geospatial (maps) technologies underlie a broad spectrum of modern mobile applications. For example, consumer-facing navigation applications (such as Google Maps and Waze) provide recommended routes along with associated times, as well as turn-by-turn navigation along those routes. Geospatial technologies are also the foundation of decision systems for ride-hailing (such as Uber, Lyft, Didi Chuxing and Ola) and delivery platforms (such as UberEats and Doordash). For example, riders on these platforms are presented with expected pickup time and time to destination, Modern mobile applications s uch as navigation services and ride-hailing platforms rely heavily on geospatial technologies, most critically predictions of the time required for a vehicle to traverse a particular route. Two major categories of pr ediction methods are segment-based approaches, which predict travel time at the level of road segments and then aggregate across the route, and route-based approaches, which use generic information about the trip such as origin and destination to predict travel time. Though various forms of these methods have bee n developed and used, there has been no rigorous theoretical c omparison of the accur acy of these two appr oaches, and empirical studies have in many cases drawn opposite conclusions. We ﬁll this gap by conducting the ﬁrst theoretical analysis to compare these two approaches in terms of their predictive accuracy as a function of the sample size of the training data (the statistical eﬃciency). We introduce a modeling framework and formally deﬁne a family of segment-based estimators and route-based estimators that resemble many practical estimators proposed in the literature and used in practice. Under both ﬁnite s ample and asymptotic settings, we give co nditions under which segment-based approa ches dominate their route-based counterparts. We ﬁnd that although route-based approaches can avoid accumulative er rors introduced by aggregating over individual road segments, such advantage is often oﬀset by (signiﬁcantly) smaller relevant sample sizes. For this reason we recommend the use of segmentbased approaches if one has to make a choice between the two metho ds in practice. Our work highlights that the accuracy of travel time predictio n is driven not just by the s ophistication of the mo de l, but also the spatial granularity at which those methods are applied. and drivers are provided with turn-by-turn navigation. Matching and pricing decisions on these platforms also heavily rely on mapping inputs to optimize for eﬃciency and reliability [ 2020]. have been proposed for this travel time pr ediction problem: (1) approaches based on predicting traﬃc and travel time at the level of road segments and turns, and aggregating across the route (“segment-based approaches”); and (2) approaches that use generic inf ormation about the origin, destination, and route to predict the travel time (“route-based approaches”). Both of these methods leverage location data traces from past vehicle trips in the road network, typically gathered (with permission) from user s of the particular application, such as a consumer-facing navigation service. practice, there has been no rigorous theoretical comparison of the accuracy of these two approaches. Empirical studies have in many cases drawn opposite conclusions. To ﬁll this gap, we conduct theoretical analyses comparing these two classes of methods in terms of their predictive accuracy as a fu nction of the training data sample size (the statistical eﬃciency). Prior Literature Segment-based approaches were developed ﬁrst, and are used by major mapping services. They involve predicting travel time on th e individual road segments of the route, and then summing/aggregating in order to provide a predicted travel time on the whole route. Road segments are the components which make up a road graph, and roughly speaking consist of the directional travel path between two intersections and within which the characteristics of the roadway (such as numb er of lanes or s peed limit) are constant. Training data for segment-based approaches is typically obtained from location information gathered from driver smartphones or ins talled devices in the vehicles (with permission and in an anonymized fashion). These location traces are then processed by a ”map-matching” algorithm to obtain travel time observations on each road segment along the driver’s trajectory [ trips, machine learning or statistical models can then be built to predict the travel time for the road segments in the route of interest (see e.g., Hoﬂeitner et al. [2012] and Jenelius and Koutsopoulos [2013]). platforms, a recent stream of literature empirically d emonstrates that alternative route-based approaches without detailed segment-level modeling may h ave promise. The features of the trip include the origin, destination, departur e time, total travel time of the trip, and other route information. A machine learning model for travel time on the entire route is ﬁt using these inpu t features. One example of such an approach is Wang et al. [2016] who proposed a s im ple nearest neighbor route-based app roach in which travel time along a route is predicted by averaging over historical trips with similar origins and destinations. They give empirical evidence that this simple route-based ap proach can outperform various segment-based approaches including state-of-the-art mapping services such as Bing and Baidu Maps. One shortcoming they suggested is that segmentbased approaches fail to handle data sparsity where certain segments have very few traversals while the nearest neighbor route-based approach bypasses this by looking at trips with similar origins and destinations. However, this argument is not entirely fair as on e can also incorporate regularization into the segment-based approaches to deal with data sparsity. Another often-claimed d rawback regarding segment-based approaches is that breaking the travel time into segments introdu ces errors because of not proper ly including the travel time at the intersection such as left/right turns and signals. However, turns and signals can be handled through better representations of the un - An important geospatial technology is prediction of th e time required for a driver (or biker, or Though many variations of the these methods have been proposed in the literature and in With a large and growing amount of trip data being collected by ﬁrms such as ride-hailing derlying road network: for example, the travel time can be estimated at the level of the segment together with the following turn and signal, rather than the road segment alone [ 2017, Hoﬂeitner et al., 2012], or diﬀerent turns can be modeled separately as additional segments [Jenelius and Koutsopoulos, 2013, Li et al., 2015]. route-based methods based on deep learning (see e.g., Jindal et al. [2017], Li et al. [2018]). These methods extract features of the route such as distance, origin and destination coordinates, departu re time, etc. Along with advanced deep neural network architectures, they are able to fu rther improve upon previous route-based approaches. However, perhaps p arad oxically, a recent stream of works demonstrate that by explicitly modeling the sequ ence of the s egments visited by the route into a deep learning framework can signiﬁcantly improve the state-of-the-art. For example, [2018] demonstrate that incorporating a recurrent neur al network (RNN) to directly model the sequential and aggregating eﬀect of segments travel times greatly boosts accuracy over the one without such structur e. in addition to other route level features is highly eﬀective. Most recently, develop and implement a graph neural network (GNN) approach to ﬂexibly predict travel times of super-segments (a set of connected road segments, roughly 20 as reported in Derrow-Pinion et al. [2021]) in Google Maps. This approach eﬀectively shares and aggregates segment-level features through the underlying road network structure. I nterestingly, they ﬁnd that by adding segmentlevel prediction errors into the loss fu nction helps the ﬁnal performance for predicting super-segment travel times. a completely apples-to-apples comparison. The diﬀerent conclusions of these papers also may be because they variously address two related but distinct problems: travel time prediction on a particular route, and travel time prediction for a p articular origin and destination when the route that the driver will take is uncertain. Our results focus on the ﬁrst of these two problems and aim to give an aﬃrmative answer — though there are situations where one approach can outperform the other, our analyses favor segment-based approaches for large road networks in most practical scenarios. between segment-based and route-based approaches is by a concatenation method based on dynamic programming to group segments into sub-paths on a trajectory to minimize empirical risk. However, their framework critically assumes independence among segment travel times and use estimated variance to replace true variance for the analysis. In this work, we provide a more general framework to rigorously analyze and quantify the accuracy of the two approaches, thus pr oviding richer (and more rigorous) insights of their comparison. Contribution We now summarize our major contributions. These perceived shortcomings of segment-based approaches inspired a proliferation of enhanced This raises the question of wh ether the perceived beneﬁts of route-based methods persist under To the best of our knowledge, the only existing work that explicitly investigates the tradeoﬀ • Modeling. We introduce a mod eling framework for the travel time estimation problem. This framework uses general priors on mean travel times and allows arbitrary road network and spatial correlation structure among segment travel times, and thus lays a theoretical foundation for analyzing the accuracy of diﬀerent travel time estimation methods. Under this framework, we formally deﬁne a family of segment-based estimators and route-based Organization The remaind er of th e paper is organized as follows. In Section the model and setup and conduct ﬁnite sample analysis when there are a given number of historical trip observations. In Section observations grows with the road network size, and trip obser vations are sampled ran domly from a route d istribution. We also analyze a grid network example to illus trate our general asymptotic results. We conclude with a brief discu ssion in Section are presented in the Appendix. We consider a setting where we are given N historical trips on an arbitrary road network (V, S) where V is a vertex set and S is an edge (road segment) set. Let y each trip. Let [N] denote the set {1, ··· , N }. Each route consists of a s equence of road segments s ∈ S. Note that road segment here is deﬁned generally that could include a segment along with a particular direction of traversin g that segment and a following turn direction. To simplify the notation, we use y observed trip. Denote the n served characteristics X classiﬁcation (arterial or local road), and a set of trip-level features W weather conditions. In addition, there are unobserved idiosyncratic characteristics of the road estimators that resemble many practical estimators proposed in the literature and used in practice. Furthermore, we explicitly characterize the optimal estimators within each family in terms of minimizing integrated risks based on squared error loss. • Finite Sample Analysis. Under any amount of samples, when segment travel times are non-negatively correlated spatially within the route, we show that the integrated risk (based on squared er ror loss) of the optimal segment-based estimator is alway s lower than that of a special case of the optimal route-based estimator where one is only allowed to use historical trips that traverse th e exact same route as the predicting route. We show that the nonnegative correlation assumption, though being n ot quite restrictive in practice, is necessary for the result to hold. • Asymptotic Analysis. To achieve more general results regarding their comparison, we extend our analysis to an asymptotic setting wh er e the number of trip observations grows as the size of the road network increases and trip observations are sampled randomly from a generic route distribution. We give conditions under w hich a large family of simple segmentbased estimators can deliver integrated risk of smaller order than that of the optimal routebased estimator wh en the road network size is large enough. This family of estimators only requires information of the prior m eans of segment travel times and encompasses popular estimators used in practice. Intuitively, the conditions require that data accumulates faster on each segment of the route than on “similar” routes in a deﬁned neighborhood of the predicting route times the length of the predicting route (number of segments on the route). We show that such conditions hold naturally in a grid network when considering a route-based estimator that uses all historical routes that are similar in origin and destination to those of the predicting route. We also give explicit rates of the integrated risk of this family of sim ple segment-based estimators as the grid size grows. In practice, segment and route travel times, TandT, are aﬀected by a set of obsegments that aﬀect their travel times. For example, some segments might have a bumpy road condition or a very lengthy intersection signal, which the mapping services might not be aware of. unobserved feature set for each road segment. T he mean of the travel time on route yP by a one-dimensional random eﬀect θ with some function h(·). This gives the route-level mean assume that h(X simplicity. This is motivated by the fact that X sparse and high-dimensional categorical feature (e.g., segment ID). One might draw an analogy between the above with a standard mixed-eﬀects model [ some unknown segment-level random eﬀects and {h(X mixed) eﬀects of obser ved segment-level and route-level features. This discussion leads us to th e following assumption regarding the generation process of T depend on. 3. For any n 6= n structure on θ we will compare the average-case accuracy when θ assumes that conditioning on all the segment-level and tr ip-level eﬀects, the segment travel times on diﬀerent trips are ind ependent, w hich is a very nature assumption in our setup as all correlations across trips are aimed to be captured in these segment-level and trip-level eﬀects. and route-level feature set W data from the N historical trips) for the total travel time following predictive error where the expectation is taken over {T Let segment travel time Thave mean g(θ, X, W) for s ome function g(·), where θis an g(θ, X, W). To simplify, we assume that the unboserved characteristics can be captured and covariances {σ}, where σ= σis the variance of the travel time on segment s. }are drawn independently from a distribution with population mean θ and variance τ. Assumption1.1 is directly motivated from the discuss ion above. Assu mption 1.2 puts a prior For a new (N +1)trip T= {y, {T}} with segment-level feature sets {X} The last equality holds as pendent conditional on {θP depend on total travel time of a new trip T with route y, we can simply look for an estimator of the means of the segment-level random eﬀects on th e new route y, denoted as Θ We will thus focus on this objective to simplify our analysis. We denote T the adjusted observed segment travel time with mean θ to {θ be subtracted from the observations . uses segment-level traversal data to estimate mean segment travel times and then aggregate over all the segments on a route to obtain an estimate for the mean route travel time. One typical way of estimating mean segment travel time is by solving a regularized regression (e.g., ridge regression) problem: min to “shrink” the estimate towards the prior mean θ if there is not much traversal data on segment s . Let N to check that Deﬁnition 1 (Segment-Based Estimator). A segment-based estimator takes the form for some φ a weighted average of the sample m ean and the population mean of the prior distribution, where the weight is sample size dependent. One would typically expect the weights {φ and tend to 1 when sample sizes increase to in ﬁnity to ensure consistency of the estimator, th ou gh this is not required for our analysis. The aforementioned estimator based on r idge regression takes the form of φ θ+ h(X, W). Further notice that the second term in the last equality does not ˆΘ, this yields, The last equality (1) implies that, to ﬁnd an estimator that minimizes pred ictive error of the }as the mean segment travel times, instead of segment-level random eﬀects, as h(·) will We ﬁrst consider a family of segment-based estimators. Intuitively, this family of estimators := |{y: s ∈ y, n ∈ [N]}| denote the sample size of traversals on segment s. It is not hardP Generalizing this observation, we n ow deﬁne a family of segment-based estimatorsˆΘ. In other words, Θis the summation of segment-level estimatorsˆθthat are constructed using ) = τN/(τN+ σ) when the segment travel times are independ ently distributed, i.e., family of segment-based estimators that uses traversal data on other road segments in S other than s to pred ict going to put a disadvantage to the segment-based estimator by excludin g such options in Deﬁnition 1. In other words, the accuracy of the segment-based estimators we analyze can be considered as upper bounds. Importantly, from a practical point of view, such simp liﬁcation of segmentbased estimators is also aligned with in dustry practice of implementing segment-based methods [Derrow-Pinion et al., 2021]. estimate th e travel time on a new route y. Denote δ(y) ⊂ y which represents the n eighb or of route y. For example, δ(y) can be historical routes that share the same or similar origin an d destination (b ut possibly with diﬀerent s equence of segments) as y. These neighboring routes are representative observations to estimate travel time on route y. Let M and |y| be the number of segments traversed on r ou te y. Similar to the segment-based estimator, one can consider an estimator the prior mean of the travel time on route y, |y|θ, if there is not much traversal data in δ(y). Again, This motivates th e following formal deﬁnition of route-based estimators. Deﬁnition 2 (Route-Based Estimator). A route-based estimator takes the f orm for some φ of all observed travel times of the historical routes in δ(y), and the prior mean of travel time on route y, where the weight is sample size dependent. Again, φ and tend to 1 when M aforementioned estimator b ased on ridge regression takes the form of φ range of estimators u sed in practice and prior literature. For example, the nearest-neighbor routebased approach used in Wang et al. [2016] considers a n eighborhood δ(y) such th at the Euclidean distances of both origins and destinations are within a threshold. Deﬁnition the implementation of many modern mapping services like Google Maps (e.g., see the status-quo method described in Derrow-Pinion et al. [2021]) and is also widely used as representative segmentbased methods in the literature. concept capturing the accuracy of the travel time prediction by integrating over the prior distr ibution of the estimand. We use the integrated risk based on mean squared error (MSE), as we reasoned in (1). This version of integrated risk is deﬁned to be the expectation of the squ ared diﬀerence between th e true total mean travel time Θ ˆΘ. This expectation is taken with respect to (1) the observed adjusted segment travel times historical route ob servations {y = 0, ∀s 6= t (see e.g., Gelman et al. [2013]). Note that one can also consider a more general We then consider a family of route-based estimators which uses route-level traversal data to =1{y∈ δ(y)} be the samp le size of traversals within rou te y’s neighborhood, T) + λ(ˆΘ−|y|θ)where λ ≥ 0 is a regularization parameter. The estimator will shrin k to has a closed form:ˆΘ= (λ/(λ+M))|y|θ+(M/(λ+M))(T/M). In words ,ˆΘestimates travel time on rou te y by a weighted average of the sample mean We note that the segment-based and route-based estimators in Deﬁnitions1 and 2 mimic a wide We now characterize the integrated risk of the two families of estimators, a Bayesian statistical }and (2) the prior distribution over the parameters {θ}, conditioning on the historical tr ips that have both segments s and t traversed. Note that N bit abuse of notation, let N from the h istorical routes in δ(y). Note that N can traverse segments that are not in y. By deﬁnition, we have N put ¯y Proposition 1. For any route y, the integrated risks of the two estimators, conditioning on the historical routes {y based estimator respectively. The expected bias comes from the shrinkage toward s the prior mean θ (which can be diﬀerent from the true means {θ choice of φ bias but introduces more variance as the estimator puts more weight on the information provided by the samples. Similarly, the ﬁrst term in ( estimator, and the sum of the second, third and forth terms collectively represents th e bias of the route-based estimator. In speciﬁc, the second term represents th e bias intro duced by including routes in δ(y) that have more or fewer road segments than y. The third term accounts for the bias of using traversal data on s egments that are not included in y. Finally, the forth term calculates the amount of bias induced by the shrin kage towards the prior mean |y|θ. In addition to φ the choice of neighborhood δ(y) also plays a signiﬁcant role here. If δ(y) is chosen to include only routes that are very similar to y, in terms of the number of segments and the set of segments they traverse, ¯y to 0 for segments s /∈ y. This will lead to a lower bias, but potentially a higher variance as the number of samples M y. Also, given a neighborhood δ(y), the optimal route-based estimator the one that minim izes the integrated risk ( result f ormally characterizes conditions. For any two road segments s, t ∈ S, deﬁne N:= |{y: s, t ∈ y, n ∈ [N]}| as the number of =|y|/Mto be the average number of segments traversed per route in δ(y). The ﬁrst and second terms in (2) correspond to the expected variance and bias of the segment- Based on the formulas of the integrated risks, we deﬁne the op timal segment-based estimator as the one that minimizes the integrated risk (2) by picking the best forms of φ(N), ∀s ∈ Proposition 2. The optimal segment-based estimator where {φ under a special case where δ(y) is chosen to be the set of historical routes that are exactly the same as y, i.e., δ(y) = {y by Proposition route are non-negative, σ estimator Theorem 1. When δ(y) = {y any historical routes y low as that of the optimal route-based estimator: |y| × |y| linear system representing the ﬁrst order conditions of ( 2. In the special case of independent segment travel times (σ closed form as φ form solution of φ In the proof, we show such a segment-based estimator already produces a weakly lower integrated risk than that of Theorem based estimator und er δ(y) always has fewer samp les compared to the sample size of any segment of the route. This is the case simply because the fact that every observation on a route y generates an ob servation for every segment s ∈ y. travel times on diﬀerent road segments can potentially be negatively correlated, we show, with the following example, that the optimal segment-based estimator can produce a strictly higher integrated risk than the optimal route-based estimator even under neighborhood δ(y) = {y y}. (N)}uniquely solves(N/N)φ(N)σ+ 2N(φ(N) − 1)τ= 0, ∀s ∈ y. On the other hand, the optimal route-based estimatorˆΘhas the following form: Our next result investigates the comparison of the two optimal estimatorsˆΘandˆΘ always has a weakly lower integrated risk compared to that of the optimal route-based In contrast toˆΘwhich has closed-form formula, computingˆΘrequires solving a 1 is that, under δ(y) = {y: y= y}, M≤ N, ∀s, t ∈ y. In other words, the route- We now s how that th e non-negative covariance assumption in Theorem 1 is critical. When Example 1. Consider a road network with only two connecting road segments 1 and 2. There are two trip observations T traverses only segment 1 (N and τ (3). The optimal segment-based estimator tions gives integrated risk of 0.515 according to ( the route-based estimator is that route-level travel times can potentially absorb the variance of segment travel times by avoiding additional aggregation. This could s ometimes create an edge over the segment-based estimator even when the route-based estimator has fewer samples. mostly n on negatively correlated. For examp le, a recent empirical study by that relatively few nearby r oad segment pairs exhibit signiﬁcantly negative correlation based on a data set w ith billions of GPS trajectories produced by more than 12,000 foating taxis in a Chinese mega city in summer 2017. Similar observations are reported in traﬃc data from Bing Maps. to draw general conclusions regarding the comparison of For example, one can always construct instances where a lot of similar routes to y exist in the historical data, and opening up δ(y) a little bit can signiﬁcantly reduce the variance of the routebased estimator while only slightly increase the bias, which leads to a lower integrated risk. To garner more insights regarding their comparisons, in the next section, we are going to analyze an asymptotic setting wh er e the numb er of ob servations grows with the size of the road network. We are going to compare the two family of estimators in terms of how their integrated risks scale with the road network size. Because we are mainly interested in comparing the rates of these scalings, this leaves us room to relax certain assumptions we need for ﬁnite sample analysis and reach more general results. In this section, we analyze the statistical eﬃciency of the two types of estimators in the asym ptotic limit as both the size of the r oad network and the number of past trips incr ease. tioned, one beneﬁ t of the asymptotic analysis is to compare the two types of estimators under more relaxed assumptions. We start by pointing out that the optimal segment-based estimator deﬁned in ( implementation on large-scale road networks. Moreover, it also requires explicit knowledge of the covariance structures among each pair of road segments σ timate in practice. As we mentioned in Section = 1. We compare the integ rated risk of the travel time on the route y = (1, 2) that has = 1. We have the optimal route-based estimatorˆΘ= (1/5) · 2θ + (4/5) · (T+ ) with φ(M) = 4/5 according to (5), which gives an integrated risk of 0.4 according to /N+ 2τφ(N) +(N/NN)σφ(N) = 2τ, ∀s ∈ y. Solving the ﬁrst order condiˆΘ=(11/75)θ + (64/75)(T+ T)/2+(9/25)θ + (16/25)T, which gives an The intuition behind the observation that negatively correlated segment travel time can beneﬁt In practice, empirical evidence often suggests segment travel times between nearby segments are When the neighborhood δ(y) can be chosen arbitrarily for the route-based estimator, it is hard tuning the regularization parameter λ through cross validation, which might not coincide with the optimal forms {φ Theorem are easy to compute for large road networks and do es not r equire any knowledge of the covariance structures. with a set of vertices (intersections) V (and possibly their following turn directions as well) S road segments |S example road network is the grid network where p represents the size of th e grid. Let Y set of all possible routes in the road network of size p. We assume that any route y ∈ Y at least one road segment, |y| ≥ 1. We further impose the following assu mption to facilitate our asymptotic analyses. Results in this section will depend on both Assumptions Assumption 2. Assume that: 1. The number of trips N in the training data grows with p, such that N → ∞ as p → ∞ . 4. There exist constants c components on a route grows at most linearly to the number of segments on that route. This is a popular assumption in the context of travel time estimation as spatial decay in correlation is widely observed in empirical studies — the (absolute value of) correlation between two road segments decreases as the distance between the two segments increases (see e.g., Bernard et al. [2006], Rachtan et al. [2013], Guo et al. [2020]). The last assumption in Assumption 2 requires the selection of neighborhood δ(y) to include routes whose lengths are similar (the average length is on the same ord er ) to the number of segments in y. risk. To generalize our result, we will need a slightly more general deﬁnition of integrated risk. Speciﬁcally, we leverage Assumption following deﬁn ition of integrated risk: where the expectation is taken with respect to (1) the distribution over the historical routes y addition to (2) the adjusted travel times {T Note that Theorem results will establish the asymptotic integrated risk of travel time estimators p → ∞ (and N → ∞). If an estimator has the proper ty lim consistent with respect to th e route sequence {y 1 holds in an asymptotic limit with a class of much simpler segment-based estimators that We ﬁrst introduce our asymptotic setting. Consider a road network indexed by a size p ∈ N, distribution µover Y. c|y| ≤ ¯y≤ c|y|. Part of Assumption2.3 restricts that the sum of all the absolute values of the (co)variance Similar to Section 2, we will compare the accuracy of diﬀerent estimatorsˆΘusing integrated With a slight abuse of notation, we deﬁne a sequence of routes {y}indexed by p. Our Notation. A few remarks on the notation: for two functions f(p) and g(p) > 0, we write f(p) = O(g (p)) (or f(p) = Ω(g(p))) if there exists a constant c (or f (p) ≥ c o (or lim universal constant c > 0 such that f(p) ≥ cg(p) (or f (p) ≤ cg(p)) for all p ≥ 1. accumulates on particular road segments and on particular routes. We denote the probability that a speciﬁc road segment s is traversed by a randomly generated route Y ∼ µ as q Y ]. Similarly, we deﬁne q neighborhood δ (y) is sampled. (deﬁned later) which the segment-based estimator is more accurate when the size of the road network gets larger. This automatically implies that the optimal segment-based estimator also dominates the optimal route-based estimator, under the same set of conditions. out restricting to non-negative covariances used in Theorem the route-based estimator to choose any neighborh ood δ(y). We characterize th e behavior and comparison of th e two estimators for estimating the travel time of a sequ ence of routes {y where y (2) and a data-scarce regime N q and collectively exhau stive. Intuitively, in the data-rich regime, the expected number of traversals of routes in δ(y grows; w hile in the data-scarce regime, the expected number of traversals of routes in δ(y bounded by a ﬁnite constant. Theorem 2. Under the data-rich regime, if we have lim segment-based estimator with φ optimal route-based estimator: An alternative suﬃcient condition is that both lim y, ∀p ∈ N. may hold that min 1 − O(1/ Remark 1. Theorem tors dominates the optimal route-based estimator. This class requires that φ enough for all road segments. This includes, for example, the estimator based on ridge regression, The key quantities determining the eﬃciency of estimators are the r ates at which training data We now give our ﬁrst asymptotic result. We compare a large family of segment-based estimator We provide this r esult with a m ore general correlation structure un der Assumption2, with- ∈ Y, ∀p ∈ N in two data growth regimes: (1) a data-rich regime where Nq= ω(1); Under the data-scarce regime, the route-based estimator is always inconsistent. However, it N) for all road segments in yis consistent. ) = N/(N+ λ), under any regularization parameter λ. ˆΘwhere all h istorical routes considered in δ(y) have the same ground-truth mean travel time as y and lower bounds its actual integrated risk. It is also worth noting that for R consistent, by ( go down to zero. ω(|y segments. This compound s the predictive error in a linearly growing way unless there is suﬃ cient data on each segment to counteract the eﬀect. Under the data-rich regime, the theorem requires all segment traversal prob ab ilities q This additional |y errors of segment travel times while th e segment-based estimator needs to sum over |y of segments. When segment travel times are all non-negatively correlated, this term disappears as the route-based estimator do es not possess such advantage anymore. segment of the route than the routes in its neighborhood times the length of the route (number of segments on the route), one should generally consider using the segment-based estimators. On the other hand, one could always construct a larger set of neighborhood δ(y) to dominate the data accumulation rates on road segments. However, such neighborhood δ(y) could also introduce a signiﬁcant amount of bias. To illustr ate the asymptotic result, we next show that the data conditions in Theorem mild conditions for a grid road network with a popular construction of neighborhood δ(y) — r ou tes that are similar in both origin and destination. point of a route), and s ∈ S adjacent vertices with a following turn direction. We use {L, R, T } to denote the left, right, through directions respectively. For example, ((i, j) → (i+1, j), L) is a horizontal eastward segment followed by a left turn. bution over vertices: where 0 < α ≤ 1 and B(·, ·) denotes the beta function. north-south coordinates of th e origin and destination are independently samp led from a symmetric beta-binomial distribution. When α < 1, th is distribution has a “horseshoe” shape, with high probability at the edges of the grid and low pr ob ab ility in the center. For α = 1, this is just the uniform distribution over V near the four corners of the grid. of all paths in Y We now discuss the data conditions in the statement. For the data-scarce regime, the rate |) emerges intuitively becauseˆΘobtains an estimate by summing over |y| numb er of Theorem2 provides the following general rule of thumb: if data accumulates faster on each Let x = (i, j) ∈ Vfor V= {0, . . . , p}denote a vertex on the grid (a possible start or end We deﬁ ne the route distribution µunder grid size p by assuming that the trip’s origin x= ) and destination x= (i, j) are drawn independently from the following probability distri- Conditional on the origin and destination x, x, we sample the route Y uniformly from the set to the grid distance |Y | = d(x distribution on routes as µ a speciﬁc origin or destination is chosen on the grid. Lemma 1. With 0 < α ≤ 1, traversed when a route is sampled from µ. Recall that here a segment is d eﬁned more generally which includes its traversal d irection and following turn. Proposition 3. Let Y ∼ µ has a traversal probability of at least a constant times p additional result (Proposition case of th e uniform distribution over origins and destinations (α = 1). y. We now consider the optimal route-based estimator considers all historical routes whose origins and destinations are close to those of the p redicting route respectively, which resembles a popu lar nearest-neighbor type of route-based estimator used in the literature and in practice. Given the route distribution µ Assumption with optimal route-based estimators based on neighborhood δ Corollary 1. When 1/2 < α ≤ 1, consider any optimal route-based estimator with neighborhood δ(·) and any segment-based estimator in y o(p for any route sequence {y lim directly checks the conditions in T heorem 2, lim achieved by the bounds provided in Lemma Lemma as the road network size grows larger, the sample size advantage of the segment-based estimator leads to a domination over the optimal route-based estimator. When 0 < α ≤ 1/2, we do not have a clear cut in terms of the comparison of their asymptotic eﬃciencies, as in such case the origins and destinations of routes h eavily concentrate in the four corners of the network. setting where the number of trip observations for trainin g N grows polynomially with the grid size p. We characterize how the integrated risks of the two estimators vary as a function of the grid size p. Utilizing this result, we now give a lower bound on the prob ab ility that a road segment s is This result shows that the worst case segment (with a traversal direction and a following turn) With a bit abuse of notation, we deﬁne x(y) and x(y) as th e origin and destination of r ou te : d(x(y), x(y)) ≤ c, d(x(y), x(y)) ≤ c} for some ﬁxed constant c. In other words, δ(·) , we have limRˆΘ/RˆΘ= 0 for any route sequence {y}with |y| = ). Under the special case of σ≥ 0, ∀s, t ∈ S, we have limRˆΘ/RˆΘ= 0 Note that since |y| = O(p) by deﬁnition, Corollary1 also implies that when 3/4 < α ≤ 1, RˆΘ/RˆΘ= 0 f or any route sequence {y}. The proof of Corollary1 1). Corollary1 shows that when the route distribution µare suﬃciently spread out over the grid, Finally, we give explicit asymptotic rates regarding this grid network example. We lo ok at a Corollary 2. If data grows as N = cp in y ξ < 4α and R mators will be consistent for any route sequence {y slower than p This complements the result in Corollary rate between p method, but also the s egment-based ones are consistent while the route-based one is inconsistent; moreover, for any date growth rate beyond p Remark 3. Similar to Theorem estimator w ith neighborhood δ(y) = {y duced by the neighboring trips. However, such a route-based estimator suﬀers from high variance and few sample size. As we show in Proposition polynomially growing horizontal and vertical diﬀerence between the origin and destination, can not keep accumulating samples under any polynomial data growth rate. Our resu lts reveal insights on the comparison of segment-based estimators with route-based estimators for route-dependent travel time prediction. Generally speaking, our results favor segment-based estimators between the two categories and identify conditions in both ﬁnite-sample and asymptotic settings under which they dominate common route-based estimators. tages of a larger sample size as there are more individual traversals on a segment level. However the estimation accumulates errors as a result of aggregating over road segments. On th e other hand, route-based estimators can have the advantage of absorb ing errors among segment tr avel times, but it is often at the cost of a (much) smaller sample size. Our results expose that, under mild conditions and for common segment-based and route-based estimators, sample size diﬀerence is often of ﬁrst-order importance, leading to favorable consideration towards a segment-based approach. prediction where one is only interested in p redicting travel time from an origin to a destination without conditioning on a route. Such settings occur in p ractice, for example, when one has little control over the route a driver will take. Route-based approaches which use data for all trip observations between the origin-destination pair can estimate travel time and the uncertain route distribution simultaneously, while segment-based approaches require additional steps to estimate such route distribution. Extending our analyses and results in such settings could be a meaningful follow-up work which we are currently exploring. and any segment-based estimatorˆΘwith φ(N) = 1 −O(1/N) for all road segments , we have RˆΘ= O(p). On the other hand, lim infRˆΘ> 0 for any Corollary2 states that when the data grows faster than p, the considered segment-based esti- At the core of our analysis is the following tradeoﬀ. Segment-based estimators h ave the advan- It remains open whether s im ilar insights hold under the setting of route-independent travel time