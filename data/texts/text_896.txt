Recent years have witnessed the increasing popularity of Location-based Social Network (LBSN) services, which provides unparalleled opportunities to build personalized Point-of-Interest (POI) recommender systems. Existing POI recommendation and location prediction tasks utilize past information for future recommendation or prediction from a single direction perspective, while the missing POI category identiﬁcation task needs to utilize the check-in information both before and after the missing category. Therefore, a long-standing challenge is how to effectively identify the missing POI categories at any time in the real-world check-in data of mobile users. To this end, in this paper, we propose a novel neural network approach to identify the missing POI categories by integrating both bidirectional global non-personal transition patterns and personal preferences of users. Speciﬁcally, we delicately design an attention matching cell to model how well the check-in category information matches their non-personal transition patterns and personal preferences. Finally, we evaluate our model on two real-world datasets, which clearly validate its effectiveness compared with the state-of-the-art baselines. Furthermore, our model can be naturally extended to address next POI category recommendation and prediction tasks with competitive performance. Keywords: Global Transition Patterns, Personal Preferences, Missing POI Category Identiﬁcation The rapid development and increasing popularity of Location-based Social Network (LBSN) services encourage more and more users to share their real-life experiences. Data collected by various LBSN services have been effectively leveraged for studying users’ online activities and mobility patterns, which provide unparalleled opportunities to built personalized POI recommender systems. Generally, the user’s historical visiting records can be regarded as a set of check-ins that each one contains a POI, a timestamp, a POI category, and so on. Indeed, the category information is con- , Pengpeng Zhao, Chang Tan, Qing He ducive to explaining users’ activities and plays a crucial role in various POI-oriented tasks. Most of the existing POI-oriented studies mainly focus on recommending or predicting the category of POI where a user may go in the future or improve the performance of next POI recommendation. Recently, considerable efforts have been made to address next POI category prediction (Zhang et al., 2017a), and utilize the category information to solve POI recommendation and location prediction problems (Chen et al., 2015; He et al., 2017; Ye et al., 2013). However, these methods utilize past information for future prediction or recommendation from a single direction perspective, while the missing POI category identiﬁcation task needs to utilize the check-in information before and after the missing category, which naturally calls for a bi-directional solution. Therefore, a long-standing challenge is how to effectively identify the missing POI categories at any time in the real-world check-in data of mobile users. Along this line, we propose a novel Bi-directional Global Transition Patterns and Personal Preferences model named Bi-GTPPP for missing POI category identiﬁcation. The proposed model takes both non-personal and personal preferences into consideration. On the one hand, users’ check-in activities usually have some public transition patterns, which are non-personal preferences. For example, users often go to dinner after work and watch a movie after dinner. The transition patterns work → dinner, dinner → movie are global and nonpersonal for all users. Our model is designed to capture bi-directional global transition patterns. On the other hand, different users have personal preferences that affect the check-in behaviors of users. These two preferences are integrated through a delicately designed attention matching cell between the output of LSTM network (Hochreiter and Schmidhuber, 1997) and the preferences. With the bi-directional global transition patterns and users’ personal preferences, the Bi-GTPPP can yield more accurate missing POI category identiﬁcation. The main contributions of this work are listed as follows: • The proposed model can address the non-trivial missing POI category identiﬁcation task via utilizing bi-directional global transition patterns and users’ personal preferences, and existing next POI category prediction methods are not suitable for our task. • The existing next POI category prediction task can be seen as a special case of the missing POI category identiﬁcation task. The proposed model can be easily extended to address the next POI category prediction task by only using forward sequence information, while the existing prediction models can not address the identiﬁcation task well. • Based on the experiments conducted on real-world datasets, the proposed Bi-GTPPP model achieves signiﬁcantly better performance compared with existing various state-of-the-art baselines. In POI-oriented studies, two important tasks are POI recommendation and location prediction. In this section, we present the related work in threefold: general POI recommendation and location prediction, categoryaware POI recommendation and location prediction, and neural network-based methods. Factoring Personalized Markov Chains and Localized Regions (Cheng et al., 2013) takes users’ movement constraint into account via exploiting the personalized Markov chain in the check-in sequence. Personalized Ranking Metric Embedding (PRME) (Feng et al., 2015) integrates sequential information, individual preference, and geographical inﬂuence to improve the recommendation performance. Graph-based Embedding (Xie et al., 2016) jointly captures the sequential effect, geographical inﬂuence, temporal cyclic effect and semantic effect by embedding into low dimensional space. More informations such as temporal effects (Gao et al., 2013), spatial-aware (Yin et al., 2017), behavior patterns (He et al., 2016), various contexts (Yang et al., 2017a) also have been studied accordingly in POI recommendation and location prediction tasks. 2.2. Category-aware POI Recommendation and Location Prediction Real-life POI-oriented tasks usually suffer from huge search space, which is because the number of POIs is large and needs a lot of computational costs, while the POI category can help ﬁlter candidate POIs and thus reduce the search space for efﬁciency and improve the recommendation performance. Context-Aware POI Category Prediction (Zhang et al., 2017a) emphasizes the signiﬁcance of category information in large-scale POI recommendation. More and more efforts have been made to utilize the category information. Ye et al. (Ye et al., 2013) proposed a framework which exploits region categories to predict the most likely location of users given their previous activities. Liu et al. (Liu et al., 2013) employed matrix factorization to predict a user’s preference on locations in the corresponding categories. A new POI recommendation problem, namely top-K location category based POI recommendation (Chen et al., 2015), has been formulated considering that users are more interested in tasting a wide range of location categories. Listwise Bayesian Personalized Ranking approach (He et al., 2017) has been proposed to predict the category ranking to ﬁlter candidate POIs. Category information has also been considered in (Zhou and Wang, 2014) and extended to more applications (Xiao et al., 2010; Rodrigues et al., 2012). 2.3. Neural Network for POI Recommendation and Location Prediction Neural networks have been used in the ﬁeld of POI recommendation and location prediction (Liu et al., 2016; Wang et al., 2017; Yin et al., 2017). For examples, a method called Spatial Temporal Recurrent Neural Networks (STRNN) (Liu et al., 2016) was proposed to model temporal and spatial contexts in each layer. Heterogeneous features and spatial-aware personal preferences were utilized by Spatial-Aware Hierarchical Collaborative Deep Learning model (Yin et al., 2017). Some LSTM-based approaches (Zhu et al., 2017; Zhao et al., 2018) try to capture short-term and long-term characteristics via speciﬁcally designed gates. User preference over POIs and context associated with users and POIs were predicted simultaneously in PACE (Preference And Context Embedding) (Yang et al., 2017a). More neural network-based approaches (Wang et al., 2017; Zhang et al., 2017b; Yang et al., 2017b) have also been adopted to address POI recommendation and location prediction. However, the above methods are not specially designed for missing POI category identiﬁcation and these efforts fail to capture both bi-directional global transition patterns and users’ personalized preferences for missing POI category identiﬁcation. So they can not address the identiﬁcation task well. Besides, the most relevant task to missing POI category identiﬁcation is the missing POI check-in identiﬁcation. The work (Xi et al., 2019) is the ﬁrst to address the missing POI check-in identiﬁcation by modelling of bi-directional spatio-temporal dependence and users’ dynamic preferences (Bi-STDDP). However, the missing POI category check-ins identiﬁcation is different from the missing POI check-in identiﬁcation in many ways. Therefore, the model is not suitable for missing POI category check-ins identiﬁcation task. In this section, we ﬁrst formulate the problem of missing POI category identiﬁcation, and then present the details of the proposed Bi-GTPPP model, which contains three parts of attention matching cell, bidirectional global transition patterns, and personal preferences. Let U = {u, u, ..., u} is a set of N users and C = {c, c, ..., c} is a set of M POI categories. Each sample is associated with a category check-ins list of user u C= {c, c, ..., c}, where cmeans user u’s lth check-in category is c. Assume the l-th check-in category cof user u is missing, the task is to identify which POI category the user u visited according to the forward sequence {c, c, ..., c} and the backward sequence {c, c, ..., c}. Firstly, we formalize a delicately designed attention matching cell which is adopted in our model to weight different preference features: where a is the feature extracted based on the existing data (e.g., check-in categories sequence) by LSTM network, b expresses the preferences which are global transition patterns or personal preferences in our model, and a and b are in the same space R. The weight s is the normalized cosine similarity between a and b, and indicates how much a matches b. If feature a matches preference b well, then preference b should have a bigger weight s, otherwise the feature a should be retained more. Note that cell(a, b) is not equal to cell(b, a). In this subsection, we ﬁrst extract features from users’ check-in categories sequence, and then integrate global transition patterns. Firstly, we capture POI category information with embedding layer. The embedding layer can be seen as performing the latent factor modeling for category popularity. It learns one matrix E, each row of which represents a POI category. If we use one-hot encoded category c, c∈ Ras input vectors, the outputs of embedding layer can be expressed as e(c) = Ec e(c) = Ec where 1 ≤ k ≤ w, and w is the window width, E∈ Rdenotes the embedding matrix for categories, d is the dimension of embedding vectors. LSTM (Hochreiter and Schmidhuber, 1997) is capable of learning short and long-term dependencies and has become an effective and scalable model for sequential prediction problems, we use the basic LSTM to capture user’s forward and backward check-in information: l= LS T M(e(c l= LS T M(e(c where e(c) and e(c) are the embedded forward and backward check-in sequences respectively, l∈ Rand l∈ Rare the bi-directional features extracted from users’ check-in categories sequence by LSTM and h is the dimension of the LSTM output space. Next, we add a hidden layer to transform the output of LSTM network to another space for applying attention matching cell: where W∈ Rand W∈ Rare the parameters of transformation matrices. Then, user’s check-in activities usually have some public transition patterns, for example, users often go to dinner after work and watch a movie after dinner. The transition patterns work → dinner, dinner → movie are global for all users. Our Bi-GTPPP model is designed to capture the global transition patterns from bi-direction. For the missing category c, we need to capture the most relevant forward global transition patterns c→ c and backward c→ c: where E∈ Rand E∈ Rdenote the forward transition embedding matrix and backward transition embedding matrix respectively, the activation function f (x) is chosen as a tanh function f (x) =. The output g∈ Rcan be normalized and expresses the transition distribution from category cto all candidate categories, and g∈ Ris the same. However, we don’t do the normalization considering the expressive power. Now, we can apply the delicately designed attention matching cell in Equation (1) to model how well the user’s bi-directional check-in information matches the global transition patterns: m= cell(h, g m= cell(h, g The attention matching cell interpolates hand g, hand grespectively, and indicates how much h matches gor hmatches g. If user u’s forward check-in information hmatches forward preference gwell, then forward preference gshould have a bigger weight, otherwise the feature hshould be retained more, and cell(h, g) is also the same. Finally, the bi-directional informations are added to capture the bi-directional global transition patterns m. Different users have personal preferences which much affect the check-in behaviors of users. For example, most users usually watch a movie after dinner, but some users have a dinner after the movie. If we identify the missing category of the personalized users as the global transition pattern dinner → movie, the model will have an erroneous identiﬁcation. So here we need to capture users’ personal preferences. If we use one-hot encoded user u ∈ Ras input vectors, then the personal preference of user u can be expressed as: where E∈ R, each row of which represents a user’s personal preferences for M categories. And the whole embedding matrix Ecan be seen as performing the latent factor modeling for all users’ personal category preferences. We can initialize the matrix Evia counting users’ visiting history on all training data and ﬁne-tune during model training. Then, the same structure attention matching cell can be adopted to model how well the user’s recent bidirectional check-in information and global transition patterns match his or her personal preferences: Finally, the prediction of the l-th category the user u has been can be computed as: where W∈ Rare the parameters in the softmax layer. The ois a distribution which indicates different probability of all possible candidate categories the user u might visit l-th. And the categories corresponding to the k maximum probabilities are the top-k identiﬁcations for the missing category. We present the ﬁnal neural network architecture of Bi-GTPPP in Figure 1. First, bi-directional category sequence features are captured by two basic LSTM network, and then the inputs of categories and user are fed into embedding layer to capture bi-directional global transition patterns and personal preferences in Equations (10), (11) and (15) respectively. Moreover, three same structure attention matching cells model how well the user’s bi-directional category sequence features match the global transition patterns and how well the user’s recent bi-directional check-in information and global transition patterns match his or her personal preferences in Equations (14) and (16) respectively. Finally, the softmax layer makes the identiﬁcation for the missing l-th category. We need to minimize the cross entropy of predicted distribution and the actual distribution: where S is the number of samples, M is the number of categories, y∈ Ris the one-hot label of sample xand θ is the parameters set. The training is performed in an end-to-end manner and the Equation (18) is used to train globally the whole architecture. Training is done through stochastic gradient descent over shufﬂed mini-batches with the Adam (Kingma and Ba, 2014) update rule. In this section, we perform experiments to evaluate the proposed Bi-GTPPP model against various baseline methods on two real-world LBSNs datasets. We ﬁrst introduce the datasets, baseline methods, implementation details and evaluation metrics of our experiments. Finally, we present our experimental results and analysis. The statistics of the two public LBSNs datasets are listed in Table 1. Foursquare, which includes long-term (about 10 months) check-in data in New York city collected from April 2012 to February 2013. NYC except from Tokyo. We eliminate users with fewer than 10 check-ins in these two datasets. Then, we sort each user’s checkin records according to timestamp order, taking the ﬁrst 80% as training set, the following 10% for the validation set and the remaining 10% for the test set. The users’ history category information is intentionally removed as ground truth for testing the identiﬁcation performance, this is consistent for all experiments for fair comparison. We compare the proposed method with counting based methods (Forward, Backward, TOP1, TOP2), traditional POI recommendation algorithms (PRME, PRME-G), neural network-based approaches (RNN, LSTM, GRU, STRNN, PACE, Bi-STDDP). Some earlier methods likes PMF (Salakhutdinov and Mnih, 2007), FPMC (Rendle et al., 2010), FPMC-LR (Cheng et al., 2013) have been proved to be not as good as PRME-G (Feng et al., 2015; Liu et al., 2016; He et al., 2017), so we don’t compare them with our model. • Forward: The forward transition probability between categories is taken as the prediction for all users. • Backward: The backward transition probability between categories is taken as the prediction for all users. • TOP1: The most popular categories in the training set are selected as the prediction for all users. • TOP2: The most popular categories in the training set are selected as the prediction for each user. • PRME(Feng et al., 2015): User and POIs are embedded into the same latent space to capture the user transition patterns. • PRME-G(Feng et al., 2015): It takes the distance between destination POIs and recent visited ones into consideration on the basis of PRME. • RNN(Zhang et al., 2014): This is a neural network method which directly models the dependency on user’s sequential behaviors into the click prediction process through the recurrent structure in RNN. • LSTM(Hochreiter and Schmidhuber, 1997): This is a special RNN model, which contains a memory cell and three multiplicative gates to learn longterm dependency. RNN model, which contains two gates and is simpler than LSTM. • STRNN(Liu et al., 2016): This is a RNN-based model for next POI recommendation. It incorporates both the time-speciﬁc transition matrices and distance-speciﬁc transition matrices within recurrent architecture. • PACE(Yang et al., 2017a): This is a deep neural architecture that jointly learns the embeddings of users and POIs to predict both user preference over POIs and various context associated with users and POIs. • Bi-STDDP(Xi et al., 2019): This is the state-ofthe-art missing POI check-in identiﬁcation model which captures bi-directional spatio-temporal dependence and users’ dynamic preferences. For all datasets we use: embedding dimension d of 128, LSTM output space h of 512, window width w of 18, mini-batch size of 128 and learning rate of 0.001. All these values are chosen via a grid search on the NYC validation set. The parameters of Eare initialized via counting users’ visiting history on training data, and all other parameters in the neural network are initialized from glorot uniform distributions (Glorot and Bengio, 2010). We do not perform any datasets-speciﬁc tuning except early stopping on validation sets. To evaluate the performance of our proposed BiGTPPP model and the baselines described above, we follow the existing works (Liu et al., 2016) to use several standard metrics: Recall@K, F1-score@K and Mean Average Precision (MAP). Recall@K is 1 if the category visited appears in the top-K ranked list; otherwise is 0. The ﬁnal Recall@K is the average value over all test ground truth instances. MAP is a global evaluation for ranking tasks, and it is usually used to evaluate the quality of the whole ranked lists. We report Recall@K and F1-score@K with K = 1, 5 and 10 in our experiments. The larger the value, the better the performance for all the evaluation metrics. All the metrics reported in the experiment are the mean over ﬁve runs. We present the experimental results evaluated by Recall@K and MAP on NYC and TKY datasets in Table 2. Besides, we also present the scatter and box plots of different methods in term of MAP over ﬁve runs in Figure 2 and Figure 3. From these results, we have the following insightful observations, - The counting-based methods Forward and Backward have acceptable performances on all two datasets. Similarly, counting-based personalized TOP2 also has a good performance on NYC and TKY, and these results are even better than PRME and PRME-G. This makes sense that users’ behavior patterns are usually regular and follow the longtailed distribution. While the non-personalized TOP1 performs differently on two datasets, this seems to show that the users’ preferences in Tokyo are more consistent than those in New York City. - PRME-G slightly improves the results comparing with PRME via incorporating distance information. And RNN-based methods (RNN, LSTM, GRU) obtain similar performance improvement TKY over PRME-G because of their sequence modeling capability. - PACE predicts user preference over POIs, user context and POI context together to achieve further improvement over RNN-based methods. Another great improvement is achieved by STRNN. It incorporates both the time-speciﬁc transition matrices and distance-speciﬁc transition matrices within recurrent architecture in each layer. Bi-STDDP achieves similar performance improvement over STRNN via incorporating both the bi-directional spatio-temporal dependence and users’ dynamic preferences, and they are the best methods among the baselines on the two datasets. However, the missing POI category check-ins identiﬁcation is a little different from the missing POI check-in identiﬁcation. POI check-ins are more dependent on spatio-temporal information (e.g., it is impossible that two POI check-ins of the same user are far apart in space distance, but the time interval is very short.), but POI category check-ins do not have the obvious spatio-temporal dependence due to POIs at different distances may belong to the same category. Therefore, the Bi-STDDP can not address the missing POI category identiﬁcation well. - Bi-GTPPP-rand outperforms the baseline methods over all evaluation metrics on all two datasets. And Bi-GTPPP-nonstatic further improves the performance via utilizing priori information and ﬁnetuning during training. On NYC dataset, the performance improvement of Bi-GTPPP-nonstatic on Recall@1, Recall@5, Recall@10 comparing with Bi-GTPPP-rand are 6.39%, 2.75%, 3.28% respectively, and comparing with best baseline BiSTDDP are 10.02%, 6.21% and 3.67% respectively which indicates that the Bi-GTPPP-nonstatic improves even more on the higher ranking list. Similar results can also be observed on TKY dataset. Besides, the baseline Bi-STDDP is designed for missing POI identiﬁcation and captures bi-directional spatio-temporal dependence, which is unsuitable for the missing POI category identiﬁcation task. Because POIs in different locations may belong to the same category, which results in the spatio-temporal dependence is poor in missing POI category identiﬁcation task. As aforesaid, POI-oriented tasks usually suffer from huge search space due to the large amount of POIs, while the POI category can help ﬁlter candidate POIs and thus reduce the search space for efﬁciency. For the TKY dataset, the numbers of the POIs and categories are 61858 and 247, respectively, and one category corresponds to 250 POIs on average. If we adopt the top 10 categories, the recall@10 is 0.8146 and we can reduce the candidate POIs from 61858 to 10 × 250 = 2500, which is a 25 times reduction. Overall, these improvements indicate the fact that the baseline methods fail to capture both global transition patterns and users’ personal preferences, while our proposed Bi-GTPPP can do this. In this subsection, we investigate the inﬂuence of the forward and backward sequences in our Bi-GTPPP model. An intuitive feeling is that bi-directional sequences can bring more useful additional information and should have a better performance than single sequence. The results shown in Table 3 conﬁrm this. The Bi-GTPPP achieves further improvement by utilizing bi-directional sequences comparing with FGTPPP and B-GTPPP which only utilize forward or backward information respectively. It must be noted that, although with the single sequence, our proposed model still achieves substantial performance improvement over various kinds of state-of-the-art methods. Based on this fact, we can say that our Bi-GTPPP can be naturally extended to address next POI category recommendation and prediction tasks with competitive performance. Next, we show that our Bi-GTPPP model can capture bi-directional global transition patterns and user’s personal preferences. The E, Eand Edenote the forward transition embedding matrix, backward transition embedding matrix and user’s personal preferences respectively which can be used directly for missing POI category identiﬁcation. The Recall@K performance of initialization and ﬁne-tuned E, Eand Eis shown in Figure 4. We observe that ﬁne-tuned Eand Ein Figure 4(a) and 4(b) greatly improve the identiﬁcation performance comparing with random initialized. And ﬁnetuned Ein Figure 4(c) also performs better than initialization which counts users’ visiting history. It turns out that bi-directional global transition patterns and user’s personalized preferences can be captured in our novel model. Besides, we can obviously see that Eobtains more gain than Eand E. It is intuitive that user’s personal preferences should play a more important role in the model than the bi-directional transition patterns. Because user’s personal preference (E) captures personal preferences for each user while the bi-directional transition patterns (Eand E) are global and nonpersonalized for all users, and personalized identiﬁcation can obtain more performance improvement. Tuning model parameters is critical to the performance of the proposed model, such as the embedding dimension d, LSTM output space h and window width w in our Bi-GTPPP model. Figure 5(a), 5(b) and 5(c) show the results under different settings of d, h and w. We present the MAP performance of Bi-GTPPP on NYC test set. Note that the best parameters are selected by grid search on NYC validation set, while the impact of parameters is evaluated on NYC test set. Validation and test results are similar under different settings. The embedding dimension d and LSTM output space h have similar performance as shown in Figure 5(a) and 5(b). We observe that as the embedding dimension and LSTM output space increase, the performance of the model is quickly improved, and then becomes stable. The embedding dimension and LSTM output space are related to model complexity, smaller values are difﬁcult to ﬁt the data, and larger values result in more complex model and require more computing resources. Making a balance between performance and efﬁciency, d = 128 and h = 512 are proper parameters. Figure 5(c) investigates the impact of window width on NYC dataset evaluated by MAP. From the experimental results, we observe that the performance ﬁrst improves quickly with the increase of window width w and then drops down gradually. The reason is that, smaller value of w prunes too many useful history information, and larger value of w brings little useful additional information and may even hurt the model performance by introducing noise information due to the long interval. We ﬁnally select w = 18 as the window width. According to Table 2 and Figure 5, we can see that even without the best parameters, Bi-GTPPP still outperforms other baseline methods. In a word, the performance of Bi-GTPPP stays stable in a large range of values of parameters and is not very sensitive to embedding dimension, LSTM output space and window width. In this paper, we proposed a novel neural network model named Bi-GTPPP to identify the missing category of POI where a user has visited at any time in the past. The Bi-GTPPP integrated bi-directional global transition patterns and personal preferences via delicately designed attention matching cells. Speciﬁcally, the attention matching cell ﬁrst bi-directionally models how well the check-in category information captured by LSTM network matches the global transition patterns. And then another attention matching cell models how well the recent check-in category information and global transition patterns of users match their personal preferences. Finally, the proposed model blue is evaluated on two large-scale real-world datasets and the results demonstrate the performance improvement of our proposed model compared with various kinds of stateof-the-art baseline methods. Also, the proposed model can be naturally extended to address next POI category prediction task with competitive performance by only using forward sequence. Several directions are available for future research in the area. First, the missing POI category identiﬁcation task can be further explored and applied to a wider range of applications, such as the urban function zone dividing and urban planning, and even used for criminal activities analysis. Second, using POI category information to assist POI-oriented research will have a broader application scenario in various real-world applications. Third, the explanation and interpretability of POI-oriented research will become more and more important. Finally, the identiﬁcation performance can be improved by combining with other disciplines, for example, by learning relevant experience from nonlinear systems (Sun et al., 2020a, 2019, 2020b). The research work supported by the National Key Research and Development Program of China under Grant No. 2018YFB1004300, the National Natural Science Foundation of China under Grant No. U1836206, U1811461, 61773361, the Project of Youth Innovation Promotion Association CAS under Grant No. 2017146.